<!DOCTYPE html>
<!-- saved from url=(0035)http://jordanranson.com/puzzlegame/ -->
<html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Jordan Ranson - Puzzle Game</title>
	<meta charset="UTF-8">
	<!-- Tools and Libraries-->
    <!--<script src="vectorEngine2d/lib/socket.io.min.js"></script>-->
    <!--<script src="./Jordan Ranson - Puzzle Game_files/stats.min.js"></script>
	<script src="./Jordan Ranson - Puzzle Game_files/util.js"></script>-->
	
	<!-- Enums -->
	<!--<script src="./Jordan Ranson - Puzzle Game_files/key.js"></script>
	<script src="./Jordan Ranson - Puzzle Game_files/resourceType.js"></script>
	<script src="./Jordan Ranson - Puzzle Game_files/gemType.js"></script>-->
	
	<!-- Scenes -->
	<!--<script src="./Jordan Ranson - Puzzle Game_files/scene.js"></script>
	<script src="./Jordan Ranson - Puzzle Game_files/level.js"></script>-->
	
	<!-- Game Objects -->
	<!--<script src="./Jordan Ranson - Puzzle Game_files/player.js"></script>
	<script src="./Jordan Ranson - Puzzle Game_files/gem.js"></script>-->
	
	<!-- Core Engine -->
	<!--<script src="./Jordan Ranson - Puzzle Game_files/renderManager.js"></script>
	<script src="./Jordan Ranson - Puzzle Game_files/inputManager.js"></script>
	<script src="./Jordan Ranson - Puzzle Game_files/sceneManager.js"></script>
	<script src="./Jordan Ranson - Puzzle Game_files/resourceManager.js"></script>
	<script src="./Jordan Ranson - Puzzle Game_files/animation.js"></script>
	<script src="./Jordan Ranson - Puzzle Game_files/gameObjectManager.js"></script>
	<script src="./Jordan Ranson - Puzzle Game_files/gemManager.js"></script>
	<script src="./Jordan Ranson - Puzzle Game_files/vectorEngine2d.js"></script>-->

	<script>
		// stats.js - http://github.com/mrdoob/stats.js
		var Stats=function(){var l=Date.now(),m=l,g=0,n=Infinity,o=0,h=0,p=Infinity,q=0,r=0,s=0,f=document.createElement("div");f.id="stats";f.addEventListener("mousedown",function(b){b.preventDefault();t(++s%2)},!1);f.style.cssText="width:80px;opacity:0.9;cursor:pointer";var a=document.createElement("div");a.id="fps";a.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#002";f.appendChild(a);var i=document.createElement("div");i.id="fpsText";i.style.cssText="color:#0ff;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px";
		i.innerHTML="FPS";a.appendChild(i);var c=document.createElement("div");c.id="fpsGraph";c.style.cssText="position:relative;width:74px;height:30px;background-color:#0ff";for(a.appendChild(c);74>c.children.length;){var j=document.createElement("span");j.style.cssText="width:1px;height:30px;float:left;background-color:#113";c.appendChild(j)}var d=document.createElement("div");d.id="ms";d.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#020;display:none";f.appendChild(d);var k=document.createElement("div");
		k.id="msText";k.style.cssText="color:#0f0;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px";k.innerHTML="MS";d.appendChild(k);var e=document.createElement("div");e.id="msGraph";e.style.cssText="position:relative;width:74px;height:30px;background-color:#0f0";for(d.appendChild(e);74>e.children.length;)j=document.createElement("span"),j.style.cssText="width:1px;height:30px;float:left;background-color:#131",e.appendChild(j);var t=function(b){s=b;switch(s){case 0:a.style.display=
		"block";d.style.display="none";break;case 1:a.style.display="none",d.style.display="block"}};return{REVISION:11,domElement:f,setMode:t,begin:function(){l=Date.now()},end:function(){var b=Date.now();g=b-l;n=Math.min(n,g);o=Math.max(o,g);k.textContent=g+" MS ("+n+"-"+o+")";var a=Math.min(30,30-30*(g/200));e.appendChild(e.firstChild).style.height=a+"px";r++;b>m+1E3&&(h=Math.round(1E3*r/(b-m)),p=Math.min(p,h),q=Math.max(q,h),i.textContent=h+" FPS ("+p+"-"+q+")",a=Math.min(30,30-30*(h/100)),c.appendChild(c.firstChild).style.height=
		a+"px",m=b,r=0);return b},update:function(){l=this.end()}}};
		var Util = {};

		// Extends options from defaults
		Util.extendParams = function(defaultParams, userParams) {
		    // Create a copy of the default params
		    var newParams = defaultParams;
		    
		    // Loop through user params and update new params
		    for (var key in userParams) {
		        newParams[key] = userParams[key];
		    }
		    return newParams;
		};

		// Converts radians to degrees
		Util.radToDeg = function(rad) {
		    return rad * (180 / Math.PI);
		};

		// Performs an AJAX request
		Util.ajax = function(url, callback) {
		    var request = new XMLHttpRequest();
		    request.open("GET", url, true);
		    request.onreadystatechange = function() {
		        if(request.readyState == 4) {
		            if(request.status == 200 || request.status == 0) {
		                callback(request.responseText);
		            } else if(request.status == 404) {
		                console.warn("Content not found:", request.statusText);
		            } else {
		                console.warn("Error loading content:", request.statusText);
		            }
		        }
		    };
		    request.send(null);
		};

		Util.getImageData = function(image) {
		    return RenderManager.getImageData(image);
		};

		var Key = {
		    backspace: 8,
		    tab: 9,
		    enter: 13,
		    shift: 16,
		    ctrl: 17,
		    alt: 18,
		    pause: 19,
		    capsLock: 20,
		    escape: 27,
		    space: 32,
		    pageUp: 33,
		    pageDown: 34,
		    end: 35,
		    home: 36,
		    leftArrow: 37,
		    upArrow: 38,
		    rightArrow: 39,
		    downArrow: 40,
		    insert: 45,
		    del: 46,
		    n0: 48,
		    n1: 49,
		    n2: 50,
		    n3: 51,
		    n4: 52,
		    n5: 53,
		    n6: 54,
		    n7: 55,
		    n8: 56,
		    n9: 57,
		    a: 65,
		    b: 66,
		    c: 67,
		    d: 68,
		    e: 69,
		    f: 70,
		    g: 71,
		    h: 72,
		    i: 73,
		    j: 74,
		    k: 75,
		    l: 76,
		    m: 77,
		    n: 78,
		    o: 79,
		    p: 80,
		    q: 81,
		    r: 82,
		    s: 83,
		    t: 84,
		    u: 85,
		    v: 86,
		    w: 87,
		    x: 88,
		    y: 89,
		    z: 90,
		    numpad0: 96,
		    numpad1: 97,
		    numpad2: 98,
		    numpad3: 99,
		    numpad4: 100,
		    numpad5: 101,
		    numpad6: 102,
		    numpad7: 103,
		    numpad8: 104,
		    numpad9: 105,
		    multiply: 106,
		    add: 107,
		    subtract: 109,
		    decimalPoint: 110,
		    divide: 111,
		    numLock: 144,
		    scrollLock: 145,
		    semicolon: 186,
		    equal: 187,
		    comma: 188,
		    dash: 189,
		    period: 190,
		    forwardSlash: 191,
		    graveAccent: 192,
		    openBracket: 219,
		    backSlash: 220,
		    closeBraket: 221,
		    singleQuote: 222,
		};

		var ResourceType = {
		    image: 0,
		    audio: 1,
		    text: 2,
		    json: 3
		}

		var GemType = {
		    red: "red",
		    green: "lime",
		    blue: "blue",
		    yellow: "yellow"
		};

		var Scene = function(game) {
		    this.game = game;
		    this.isPaused = true;
		};

		Scene.prototype.loadContent = function(resourceManager) {

		};

		Scene.prototype.unload = function(callback) {
		    callback();
		};

		Scene.prototype.update = function() {

		};

		Scene.prototype.draw = function() {

		};

		var Level = function(game, levelId) {
		    this.renderManager = game.renderManager;
		    this.resourceManager = game.resourceManager;
		    this.inputManager = game.inputManager;
		    this.sceneManager = game.sceneManager;
		    this.levelWidth = 7;
		    this.levelHeight = 13;
		    this.gemSize = 48;
		    this.playingFieldX = (this.renderManager.canvas.width - this.levelWidth * this.gemSize) / 2;
		    this.playingFieldY = 85;
		    this.gameObjectManager = new GameObjectManager(this);
		    this.gemManager = new GemManager(this);
		    this.game = game;
		    this.player;
		    this.newLineCounter = 0;
		    this.newLineInterval = 4000;
		    this.timeWhenPaused = 0;
		    this.multiplier = 0;
		    this.score = 0;
		    
		    // States
		    this.isPlaying = true;
		    this.isGameOver = false;
		    this.isPaused = false;

		    // Add game objects like the player
		    //this.gameObjectManager.addObject();
		};

		Level.prototype.init = function() {
		    var _this = this;
		    
		    // Pause the game
		    this.inputManager.addKeyEvent(KeyAction.cancel, function() {
		        _this.isPaused = !_this.isPaused;
		        if(!_this.isPaused) {
		            _this.timeWhenPaused = _this.game.curTime;
		        }
		    });
		    
		    /* Debug keys */
		    
		    // Toggle wireframes
		    this.inputManager.addKeyEvent(KeyAction.func1, function() {
		        _this.renderManager.wireframes = !_this.renderManager.wireframes;
		    }); 
		    
		    this.player = new Player(this, 0);
		    this.gemManager.newLine();
		    this.gameObjectManager.addObject(this.player);
		    
		    // Update first tick early so everything appears to be in position before drawing
		    this.update();
		};

		Level.prototype.loadContent = function() {
		    var timestamp = new Date().getTime();
		    //this.resourceManager.load("levels/test.txt?" + timestamp, "test-level", ResourceType.text);
		    this.gameObjectManager.loadContent();
		};

		Level.prototype.unload = function(callback) {
		    this.inputManager.removeKeyEvent(this.inputManager.keyAction.cancel);
		    callback();
		};

		Level.prototype.update = function() {
		    if(!this.isPaused) {
		        this.gameObjectManager.update();
		        this.gemManager.update();
		        
		        this.newLineCounter += this.game.curTime - this.game.lastTime;
		        if(this.newLineCounter > this.newLineInterval && this.isPlaying) {
		            this.gemManager.newLine();
		            this.player.forceUpdate();
		            this.newLineCounter = 0;
		        }
		    }
		    
		    if(this.isGameOver && this.isPlaying) {
		        this.isPlaying = false;
		    }
		};

		Level.prototype.draw = function() {
		    // Gameplay area
		    if(this.renderManager.wireframes) {
		        this.renderManager.drawRectangle(
		            this.playingFieldX - 2, this.playingFieldY - 2, (this.levelWidth * this.gemSize) + 4, (this.levelHeight * this.gemSize) + 4 - this.gemSize, "#666", 4, "transparent"
		        );
		        
		        this.renderManager.drawText(
		            this.renderManager.canvas.width / 2, this.playingFieldY - 38,
		            "#ccc", "14pt sans-serif", "center", "Score - " + this.score
		        );
		        
		        for(var i = 0; i < this.player.heldGems.length; i++) {
		            this.renderManager.drawCircle(
		                this.playingFieldX - this.gemSize / 2 - 15, 
		                this.playingFieldY + (i * this.gemSize) + (this.gemSize / 2), this.gemSize / 2,
		                "transparent", 0, this.player.heldGems[0].type
		            );
		        };
		        
		        var flash;
		        if(this.isPaused) {
		            flash = this.timeWhenPaused % 3 == 0 ? "#f0f" : (this.timeWhenPaused % 3 == 1 ? "#0ff" : "#ff0");
		        } else {
		            flash = this.game.curTime % 3 == 0 ? "#f0f" : (this.game.curTime % 3 == 1 ? "#0ff" : "#ff0");
		        }
		        if(this.player.heldGems.length === this.player.inventorySize) {
		            this.renderManager.drawText(
		                this.playingFieldX - this.gemSize / 2 - 15 + 1,
		                this.playingFieldY + ((this.player.heldGems.length - 1) * this.gemSize) + (this.gemSize / 2) + 4 + 1,
		                "#000", "bold 9pt sans-serif", "center", "MAX"
		            );
		            this.renderManager.drawText(
		                this.playingFieldX - this.gemSize / 2 - 15,
		                this.playingFieldY + ((this.player.heldGems.length - 1) * this.gemSize) + (this.gemSize / 2) + 4,
		                flash, "bold 9pt sans-serif", "center", "MAX"
		            );
		        }
		    }
		    
		    // Draw game objects
		    this.gemManager.draw();
		    this.gameObjectManager.draw();
		    
		    // Game over
		    if(this.isGameOver) {
		        this.renderManager.drawText(
		            this.renderManager.canvas.width / 2 + 2, this.renderManager.canvas.height / 2 + 2,
		            "#000", "20pt sans-serif", "center", "Game Over!"
		        );
		        this.renderManager.drawText(
		            this.renderManager.canvas.width / 2, this.renderManager.canvas.height / 2,
		            "#fff", "20pt sans-serif", "center", "Game Over!"
		        );
		    }
		    
		    // Draw pause menu
		    if(this.isPaused) {
		        this.renderManager.drawRectangle(
		            0, 0, this.renderManager.canvas.width, this.renderManager.canvas.height,
		            "transparent", 0, "#141414"
		        );
		        
		        this.renderManager.drawText(
		            this.renderManager.canvas.width / 2 + 2, this.renderManager.canvas.height / 2 + 2 - 20,
		            "#000", "20pt sans-serif", "center", "Paused"
		        );
		        this.renderManager.drawText(
		            this.renderManager.canvas.width / 2, this.renderManager.canvas.height / 2 - 20,
		            "#fff", "20pt sans-serif", "center", "Paused"
		        );
		        
		        this.renderManager.drawText(
		            this.renderManager.canvas.width / 2, this.renderManager.canvas.height / 2 + 10,
		            "#777", "8pt sans-serif", "center", "LEFT/RIGHT ARROWS - MOVE"
		        );
		        this.renderManager.drawText(
		            this.renderManager.canvas.width / 2, this.renderManager.canvas.height / 2 + 30,
		            "#777", "8pt sans-serif", "center", "DOWN ARROW - GRAB GEMS"
		        );
		        this.renderManager.drawText(
		            this.renderManager.canvas.width / 2, this.renderManager.canvas.height / 2 + 50,
		            "#777", "8pt sans-serif", "center", "UP ARROW - SHOOT GEMS"
		        );
		        this.renderManager.drawText(
		            this.renderManager.canvas.width / 2, this.renderManager.canvas.height / 2 + 80,
		            "#fff", "10pt sans-serif", "center", "Try to match 3 or more gems in a row."
		        );
		    }
		};

		var Player = function(scene, y) {
		    this.scene = scene;
		    this.x = 3;
		    this.y = y;
		    this.lastX = 3;
		    
		    this.inventorySize = 4;
		    this.heldGems = [];
		    
		    this.init();
		};

		Player.prototype.loadContent = function() {
		    
		};

		Player.prototype.init = function() {
		    var _this = this;
		    
		    this.scene.inputManager.addKeyEvent(Key.rightArrow, function() {
		        if(!_this.scene.isPaused && _this.scene.isPlaying) {
		            if(_this.x >= _this.scene.levelWidth - 1) { _this.x = 0; }
		            else { _this.x++; }
		        }
		    });
		    
		    this.scene.inputManager.addKeyEvent(KeyAction.backward, function() {
		        if(!_this.scene.isPaused && _this.scene.isPlaying) {
		            if(_this.x <= 0) { _this.x = _this.scene.levelWidth - 1; }
		            else { _this.x--; }
		        }
		    });
		    
		    this.scene.inputManager.addKeyEvent(Key.h, function() {
		        if(_this.scene.isPlaying && _this.scene.isPlaying) {
		            _this.scene.gemManager.newLine();
		            _this.forceUpdate();
		        }
		    });
		    
		    this.scene.inputManager.addKeyEvent(Key.g, function() {
		        if(_this.scene.isPlaying && _this.scene.isPlaying) {
		            _this.scene.gemManager.collapse();
		            _this.forceUpdate();
		        }
		    });
		    
		    this.scene.inputManager.addKeyEvent(KeyAction.down, function() {
		        if(!_this.scene.isPaused && _this.scene.isPlaying) {
		            if(_this.heldGems.length > 0) {
		                var heldGems = _this.scene.gemManager.getClosestGroup(_this.x, _this.inventorySize - _this.heldGems.length, _this.heldGems[0].type);
		                for(var i = 0; i < heldGems.length; i++) {
		                    _this.heldGems.push(heldGems[i]);
		                }
		            } else {
		                var heldGems = _this.scene.gemManager.getClosestGroup(_this.x, _this.inventorySize);
		                for(var i = 0; i < heldGems.length; i++) {
		                    _this.heldGems.push(heldGems[i]);
		                }
		            }
		            _this.forceUpdate();
		        }
		    });
		    
		    this.scene.inputManager.addKeyEvent(KeyAction.up, function() {
		        if(!_this.scene.isPaused) {
		            if(_this.heldGems.length > 0) {
		                if(_this.scene.gemManager.placeGems(_this.x, _this.heldGems)) {
		                    _this.scene.gemManager.tryToClear(_this.x, _this.heldGems[0].type);
		                    _this.scene.gemManager.collapse();
		                    _this.heldGems = [];
		                    _this.forceUpdate();
		                }
		            }
		        }
		    });
		};

		Player.prototype.forceUpdate = function() {
		    this.y = this.scene.gemManager.findClosestOpen(this.x);
		};

		Player.prototype.update = function() {
		    if(this.x !== this.lastX) {
		        this.y = this.scene.gemManager.findClosestOpen(this.x);
		    }
		    
		    this.lastX = this.x;
		};

		Player.prototype.draw = function() {
		    var renderManager = this.scene.renderManager;
		    if(renderManager.wireframes) {
		        
		        
		        var radius = this.scene.gemSize / 2;
		        var ptx = this.scene.playingFieldX + (this.x * this.scene.gemSize) + radius;
		        var pty = this.scene.playingFieldY + (this.y * this.scene.gemSize) + radius;
		        var basey = this.scene.playingFieldY + (this.scene.levelHeight * this.scene.gemSize) - radius;
		        var topy = this.scene.playingFieldY - radius;
		        
		        var playerColor;
		        if(this.heldGems.length > 0) {
		            playerColor = this.heldGems[0].type;
		        } else {
		            playerColor = "#ccc";
		        }
		        
		        var flash;
		        if(this.scene.isPaused) {
		            flash = this.scene.timeWhenPaused % 3 == 0 ? "#f0f" : (this.scene.timeWhenPaused % 3 == 1 ? "#0ff" : "#ff0");
		        } else {
		            flash = this.scene.game.curTime % 3 == 0 ? "#f0f" : (this.scene.game.curTime % 3 == 1 ? "#0ff" : "#ff0");
		        }
		        
		        if(this.heldGems.length < this.inventorySize) {
		            var height;
		            if(this.heldGems.length > 0) {
		                height = this.scene.gemManager.getClosestGroup(this.x, this.inventorySize - this.heldGems.length, this.heldGems[0].type, true);
		                height = height.length;
		                
		                
		            } else {
		                height = this.scene.gemManager.getClosestGroup(this.x, this.inventorySize - this.heldGems.length, false, true);
		                height = height.length;
		                
		                
		            }
		            if(this.y >= 0 && height > 0 && !this.isGameOver) {
		                renderManager.drawRectangle(
		                    ptx - radius + 2, (pty - radius + 2) - ((height - 1) * this.scene.gemSize),
		                    (radius * 2) - 4, (height * this.scene.gemSize) - 4,
		                    flash, 4, "transparent"
		                );
		            }
		        }
		        
		        renderManager.drawLine(ptx, pty + radius + 16, ptx, basey, "#242424", 6);
		        renderManager.drawPolyline(
		            [
		                {x: ptx - 12, y: pty + 24 + radius},
		                {x: ptx,     y: pty + 8 + radius},
		                {x: ptx + 12, y: pty + 24 + radius},
		                {x: ptx - 12, y: pty + 24 + radius}
		            ],
		            "transparent", 0, playerColor
		        );
		        renderManager.drawCircle(ptx, basey, radius / 2, "transparent", 0, playerColor);
		    }
		};

		var Gem = function(scene, x, y, size, type) {
		    this.scene = scene;
		    this.x = x;
		    this.y = y;
		    this.size = size;
		    this.type = type;
		};

		Gem.prototype.loadContent = function() {
		    
		};

		Gem.prototype.init = function() {
		    
		};

		Gem.prototype.update = function() {
		    
		};

		Gem.prototype.draw = function() {
		    var renderManager = this.scene.renderManager;
		    if(renderManager.wireframes) {
		        var radius = this.size / 2;
		        
		        
		        renderManager.drawCircle(
		            this.scene.playingFieldX + ((this.x * this.size) + radius), 
		            this.scene.playingFieldY + ((this.y * this.size) + radius), radius,
		            "transparent", 0, this.type
		        );
		    }
		};

		var RenderManager = function(canvas) {
		    this.canvas = document.createElement("canvas");
		    this.canvas.height = 720;
		    this.canvas.width = 480;
		    this.context = this.canvas.getContext("2d");
		    this.drawingCanvas = document.getElementById(canvas);
		    this.drawingCanvasContext = this.drawingCanvas.getContext("2d");
		    this.wireframes = true;
		};

		RenderManager.prototype.smoothImageScaling = function(smoothing) {
		    this.context.imageSmoothingEnabled = smoothing;
		    this.context.webkitImageSmoothingEnabled = smoothing;
		    this.context.mozImageSmoothingEnabled = smoothing;
		    this.drawingCanvasContext.imageSmoothingEnabled = smoothing;
		    this.drawingCanvasContext.webkitImageSmoothingEnabled = smoothing;
		    this.drawingCanvasContext.mozImageSmoothingEnabled = smoothing;
		};

		RenderManager.prototype.clear = function(color) {
		    this.context.save();

		    // Use the identity matrix while clearing the canvas
		    this.context.setTransform(1, 0, 0, 1, 0, 0);
		    this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);
		    
		    if(color) {
		        this.drawRectangle(0, 0, this.canvas.width, this.canvas.height, "transparent", 0, color);
		    }

		    // Restore the transform
		    this.context.restore();
		};

		RenderManager.prototype.drawLine = function(x1, y1, x2, y2, strokeColor, strokeWidth) { 
		    this.context.beginPath();
		    this.context.moveTo(x1, y1);
		    this.context.lineTo(x2, y2);
		    this.context.lineWidth = strokeWidth;
		    this.context.strokeStyle = strokeColor;
		    this.context.stroke();
		};

		RenderManager.prototype.drawCircle = function(cx, cy, r, strokeColor, strokeWidth, fillColor) { 
		    this.context.beginPath();
		    this.context.arc(cx, cy, r, 0, 2 * Math.PI, false);
		    this.context.fillStyle = fillColor;
		    this.context.fill();
		    this.context.lineWidth = strokeWidth;
		    this.context.strokeStyle = strokeColor;
		    this.context.stroke();
		};

		RenderManager.prototype.drawArc = function(cx, cy, r, angleStart, distance, strokeColor, strokeWidth, fillColor) { 
		    this.context.beginPath();
		    this.context.arc(cx, cy, r, angleStart, distance, false);
		    this.context.fillStyle = fillColor;
		    this.context.fill();
		    this.context.lineWidth = strokeWidth;
		    this.context.strokeStyle = strokeColor;
		    this.context.stroke();
		};

		RenderManager.prototype.drawRectangle = function(x, y, width, height, strokeColor, strokeWidth, fillColor) { 
		    this.context.beginPath();
		    this.context.rect(x, y, width, height);
		    this.context.fillStyle = fillColor;
		    this.context.fill();
		    this.context.lineWidth = strokeWidth;
		    this.context.strokeStyle = strokeColor;
		    this.context.stroke();
		};

		RenderManager.prototype.drawText = function(x, y, fillColor, fontStyle, textAlign, text) { 
		    this.context.font = fontStyle;
		    this.context.textAlign = textAlign;
		    this.context.fillStyle = fillColor;
		    this.context.fillText(text, x, y);
		};

		RenderManager.prototype.drawBackground = function(image, x, y, width, height) { 
		    this.context.fillStyle = this.context.createPattern(image, "repeat");
		    this.context.fillRect(x, y, width, height);
		};

		RenderManager.prototype.drawImage = function(image, x, y, width, height) { 
		    if(typeof(width) != "undefined") {
		        this.context.drawImage(image, x, y, width, height);
		    } else {
		        this.context.drawImage(image, x, y);
		    }
		};

		RenderManager.prototype.drawSprite = function(image, x, y, width, height, sx, sy, swidth, sheight, angle) { 
		    if(typeof(angle) != "undefined") {
		        this.context.save();
		        this.context.rotate(angle);
		    }

		    if(typeof(sx) != "undefined") {
		        this.context.drawImage(image, sx, sy, swidth, sheight, x, y, width, height);
		    } else if(typeof(width) != "undefined") {
		        this.context.drawImage(image, x, y, width, height);
		    } else {
		        this.context.drawImage(image, x, y);
		    }
		    
		    if(typeof(angle) != "undefined") {
		        this.context.restore();
		    }
		};

		RenderManager.prototype.drawPolyline = function(points, strokeColor, strokeWidth, fillColor) { 
		    this.context.save();

		    this.context.beginPath();
		    for(var i = 0; i < points.length; i++) {
		        if(i === 0) {
		            this.context.moveTo(points[i].x, points[i].y);
		        } else {
		            this.context.lineTo(points[i].x, points[i].y);
		        }
		    }
		    this.context.closePath();
		    
		    this.context.lineWidth = strokeWidth;
		    this.context.strokeStyle = strokeColor;
		    this.context.stroke();
		    
		    this.context.fillStyle = fillColor;
		    this.context.fill();
		    
		    this.context.restore();
		};

		RenderManager.prototype.drawPolysprite = function(points, strokeColor, strokeWidth, fillColor) { 
		    this.context.save();

		    this.context.beginPath();
		    for(var i = 0; i < points.length; i++) {
		        if(i === 0) {
		            this.context.moveTo(points[i].x, points[i].y);
		        } else {
		            this.context.lineTo(points[i].x, points[i].y);
		        }
		    }
		    this.context.closePath();
		    
		    this.context.lineWidth = strokeWidth;
		    this.context.strokeStyle = strokeColor;
		    this.context.stroke();
		    
		    this.context.fillStyle = fillColor;
		    this.context.fill();
		    
		    this.context.restore();
		};

		RenderManager.getImageData = function(image) {
		    var canvas = document.createElement("canvas");
		    canvas.width = image.width;
		    canvas.height = image.height;
		    
		    var context = canvas.getContext("2d");
		    context.drawImage(image, 0, 0);
		    
		    var imageData = context.getImageData(0, 0, image.width, image.height);
		    
		    return imageData;
		};

		var KeyAction = {};

		var InputManager = function(keyMap) {
		    var defaultKeyMap = {
		        up: Key.upArrow,
		        down: Key.downArrow,
		        forward: Key.rightArrow,
		        backward: Key.leftArrow,
		        jump: Key.upArrow,
		        action1: Key.z,
		        action2: Key.x,
		        action3: Key.c,
		        action4: Key.a,
		        action5: Key.s,
		        accept: Key.enter,
		        cancel: Key.escape,
		        pause: Key.pause,
		        func1: Key.numpad1,
		        func2: Key.numpad2,
		        func3: Key.numpad3,
		        func4: Key.numpad4,
		        func5: Key.numpad5,
		        func6: Key.numpad6
		    };
		    
		    var _this = this;
		    this.keyEvents = {};
		    this.keysPressed = {};
		    this.keyAction = Util.extendParams(defaultKeyMap, keyMap);
		    KeyAction = this.keyAction;
		    
		    this.keydown = function(e) {
		        this.keysPressed[e.keyCode] = true;
		        if(typeof(this.keyEvents[e.keyCode]) == "function") {
		            this.keyEvents[e.keyCode]();
		        }
		    };

		    this.keyup = function(e) {
		        delete this.keysPressed[e.keyCode];
		    };
		    
		    window.addEventListener('keyup', function(e) { _this.keyup(e); }, false);
		    window.addEventListener('keydown', function(e) { _this.keydown(e); }, false);
		};

		InputManager.prototype.isKeyDown = function(keyCode) {
		    return this.keysPressed[keyCode];
		};

		InputManager.prototype.addKeyEvent = function(keyCode, callback) {
		    this.keyEvents[keyCode] = callback;
		};

		InputManager.prototype.removeKeyEvent = function(keyCode) {
		    delete this.keyEvents[keyCode];
		};

		var SceneManager = function(game) {
		    this.game = game;
		    this.scene = new Scene(game);
		};

		SceneManager.prototype.loadScene = function(scene) {
		    var _this = this;
		    this.scene.unload(function() {
		        // Load scene content before loading the scene
		        scene.loadContent(_this.game.resourceManager);
		        _this.game.resourceManager.runQueue();
		        var timer = setInterval(function() {
		            if(!_this.game.resourceManager.isLoading) {
		                clearInterval(timer);
		                scene.init();
		                _this.scene = scene;
		            }
		        }, 100);
		    });
		};

		SceneManager.prototype.update = function() {
		    if(!this.scene.isPaused) {
		        this.scene.update();
		    }
		};

		SceneManager.prototype.draw = function() {
		    this.scene.draw();
		};

		var ResourceManager = function(contentPath) {
		    this.contentPath = contentPath;
		    this.images = {};
		    this.audio = {};
		    this.generic = {};
		    this.queue = [];
		    
		    this.isLoading = false;
		};

		// Add a resource to the load queue
		ResourceManager.prototype.load = function(url, resourceName, resourceType, callback) {
		    var resource = {url: url, resourceName: resourceName, resourceType: resourceType, callback: callback};
		    this.queue.push(resource);
		};

		ResourceManager.prototype.runQueue = function(num) {
		    // First call
		    if(typeof(num) === "undefined") { num = 0; };
		    
		    // Finished loading
		    if(num == this.queue.length) {
		        this.isLoading = false;
		        this.queue = [];
		        return;
		    }

		    // If has resource to load
		    if(this.queue.length > 0) {
		        this.isLoading = true;
		        this.loadResource(this.queue[num], num);
		    } else {
		        this.isLoading = false;
		    }
		};

		// Load resource from URL
		ResourceManager.prototype.loadResource = function(resourceDefn, num) {
		    var resource;
		    var _this = this;
		    
		    // Image file
		    if(resourceDefn.resourceType === ResourceType.image) {
		        // Check to see if resource has already been loaded
		        var resources = this.images;
		        for (var prop in resources) {
		            if(prop == resourceDefn.resourceName) { return; }
		        }
		        
		        // Create, load and store resource
		        resource = new Image();
		        resource.addEventListener("load", function() {
		            resources[resourceDefn.resourceName] = resource;
		            _this.runQueue(num + 1);
		            if(resourceDefn.callback) { resourceDefn.callback(); };
		        });
		        resource.src = this.contentPath + resourceDefn.url;
		    }
		    
		    // Audio file
		    if(resourceDefn.resourceType === ResourceType.audio) {
		        // Check to see if resource has already been loaded
		        var resources = this.audio;
		        for (var prop in resources) {
		            if(prop == resourceDefn.resourceName) { return; }
		        }
		        
		        // Create, load and store resource
		        resource = new Audio();
		        resource.addEventListener("canplaythrough", function() {
		            resources[resourceDefn.resourceName] = resource;
		            _this.runQueue(num + 1);
		            if(resourceDefn.callback) { resourceDefn.callback(); };
		        });
		        resource.src = this.contentPath + resourceDefn.url;
		        resource.load();
		    }
		    
		    // Plain text
		    if(resourceDefn.resourceType === ResourceType.text) {
		        // Check to see if resource has already been loaded
		        var resources = this.generic;
		        for (var prop in resources) {
		            if(prop == resourceDefn.resourceName) { return; }
		        }
		        
		        // Create, load and store resource
		        Util.ajax(this.contentPath + resourceDefn.url, function(responseText) {
		            resources[resourceDefn.resourceName] = responseText;
		            _this.runQueue(num + 1);
		            if(resourceDefn.callback) { resourceDefn.callback(); };
		        });
		    }
		    
		    // JSON
		    if(resourceDefn.resourceType === ResourceType.json) {
		        // Check to see if resource has already been loaded
		        var resources = this.generic;
		        for (var prop in resources) {
		            if(prop == resourceDefn.resourceName) { return; }
		        }
		        
		        // Create, load and store resource
		        Util.ajax(this.contentPath + resourceDefn.url, function(responseText) {
		            resources[resourceDefn.resourceName] = JSON.parse(responseText);
		            _this.runQueue(num + 1);
		            if(resourceDefn.callback) { resourceDefn.callback(); };
		        });
		    }
		};

		var Animation = function(sx, sy, swidth, sheight, frames, duration, loops) {
		    this.sx = sx;
		    this.sy = sy;
		    this.swidth = swidth;
		    this.sheight = sheight;
		    this.frames = frames;
		    this.frame = 0;
		    this.duration = 2.5;
		    this.loops = loops;
		    this.loop = 0;
		    this.timePlaying = 0;
		    this.lastTime = 0;
		};

		Animation.prototype.play = function(renderManager, image, x, y, angle, speed) {
		    var curTime = (this.timePlaying % this.duration);
		    
		    if(curTime < this.lastTime) {
		        this.frame++;
		    }
		    
		    if(this.frame >= this.frames) {
		        this.frame = 0;
		        this.loop++;
		    }

		    renderManager.drawSprite(image, x, y, this.swidth, this.sheight, this.sx + (this.swidth * this.frame), this.sy, this.swidth, this.sheight, angle);
		    
		    this.lastTime = curTime;
		    this.timePlaying += speed < 0.2 ? 0.2 : speed;
		};

		var GameObjectManager = function(scene) {
		    this.scene = scene;
		    this.gameObjects = [];
		};

		GameObjectManager.prototype.loadContent = function() {
		    for(var i = 0; i < this.gameObjects.length; i++) {
		        this.gameObjects[i].loadContent();
		    }
		}

		GameObjectManager.prototype.addObject = function(gameObject) {
		    this.gameObjects.push(gameObject);
		};

		GameObjectManager.prototype.update = function() {
		    for(var i = 0; i < this.gameObjects.length; i++) {
		        this.gameObjects[i].update();
		    }
		};

		GameObjectManager.prototype.draw = function() {
		    for(var i = 0; i < this.gameObjects.length; i++) {
		        this.gameObjects[i].draw();
		    }
		};

		var GemManager = function(scene) {
		    this.scene = scene;
		    this.gems = this.createEmptyArray();
		    
		    this.gemsNeededToClear = 3;
		};

		GemManager.prototype.loadContent = function() {
		    for(var y = 0; y < this.gems.length; y++) {
		        for(var x = 0; x < this.gems[y].length; x++) {
		            this.gems[y][x].loadContent();
		        }
		    }
		};

		// Returns an array the size of the playing field, filled with -1 values
		GemManager.prototype.createEmptyArray = function() {
		    var arr = [];
		    for(var y = 0; y < this.scene.levelHeight; y++) {
		        arr[y] = [];
		        for(var x = 0; x < this.scene.levelWidth; x++) {
		            arr[y][x] = -1
		        }
		    }

		    return arr;
		};

		// Adds a new line to the top of the playfield
		GemManager.prototype.newLine = function() {
		    var gem;
		    var tempGems = this.createEmptyArray();

		    // Shift old gems down 1 space
		    for(var y = 0; y < this.gems.length; y++) {
		        for(var x = 0; x < this.gems[y].length; x++) {
		            gem = this.gems[y][x];
		            
		            if(gem !== -1) { gem.y++; } 
		            if(y + 1 < this.scene.levelHeight) {
		                tempGems[y + 1][x] = gem;
		            }
		        }
		    }
		    
		    // Create a new line of gems to be added
		    var random, type;
		    for(var i = 0; i < this.scene.levelWidth; i ++) {
		        random = Number((Math.random() * 3).toFixed());
		        type = random === 0 ? GemType.red : (
		               random === 1 ? GemType.green : (
		               random === 2 ? GemType.blue : (
		               random === 3 ? GemType.yellow : -1)));
		        if(type === -1) {
		            tempGems[0][i] = -1;
		        } else {
		            tempGems[0][i] = new Gem(this.scene, i, 0, this.scene.gemSize, type);
		        }
		    }
		    
		    this.gems = tempGems;
		    this.checkIfDead();
		};

		// Returns if the playfield is filled, game over if true
		GemManager.prototype.checkIfDead = function() {
		    for(var x = 0; x < this.gems[this.gems.length - 1].length; x++) {
		        gem = this.gems[this.gems.length - 2][x];
		        if(gem !== -1) {
		            this.scene.isGameOver = true;
		            return true;
		        }
		    }
		    
		    return false;
		};


		// Returns the closest group of gems of the same type found
		GemManager.prototype.getClosestGroup = function(x, maxLength, gemType, keepGems) {
		    var gem;
		    var type = -1;
		    var found = [];
		    
		    if(gemType) {
		        type = gemType;
		    }
		    
		    for(var y = this.scene.levelHeight - 1; y >= 0; y--) {
		        gem = this.gems[y][x];
		        
		        // Limit the number that can be returned
		        if(found.length < maxLength) {
		            if(gem !== -1) { // if not air
		                if(type === -1) { // on first gem found
		                    type = gem.type;
		                    found.push(gem);
		                    if(!keepGems) { this.gems[y][x] = -1; }
		                } else { // find gems of the same type
		                    if(gem.type === type) {
		                        found.push(gem);
		                        if(!keepGems) { this.gems[y][x] = -1; }
		                    } else {
		                        break;
		                    }
		                }
		            }
		        }
		    }
		    
		    return found;
		};

		// Returns the closest gem y position in the playfield
		GemManager.prototype.findClosestOpen = function(x) {
		    for(var y = this.scene.levelHeight - 1; y >= 0; y--) {
		        if(this.gems[y][x] !== -1) {
		            return y;
		        }
		    }
		    
		    return -1;
		};

		// Attempts to place gems in a column
		GemManager.prototype.placeGems = function(x, gems) {
		    var ystart = this.findClosestOpen(x) + 1;
		    var gem;

		    for(var y = 0; y < gems.length; y++) {
		        // Check if this will cause suicide by placing gems at the kill line
		        if(ystart + gems.length === this.scene.levelHeight - 1) {
		            // Check if gem exists in location and is of the same type as gem being placed
		            if((this.gems[y + ystart - 1] && this.gems[y + ystart - 1][x] && gems[y].type === this.gems[y + ystart - 1][x].type) 
		            || (gems.length >= this.gemsNeededToClear)) {
		                // Place gem if it will clear, even if it will hit the kill line
		                gems[y].y = y + ystart;
		                gems[y].x = x;
		                this.gems[y + ystart][x] = gems[y];
		            } else {
		                return false;
		            }
		        }
		        else if(ystart + gems.length > this.scene.levelHeight - 1) {
		            return false;
		        }
		        // Place gem normally
		        gems[y].y = y + ystart;
		        gems[y].x = x;
		        this.gems[y + ystart][x] = gems[y];
		    }
		    
		    return true;
		};

		// Tries to clear a group of gems
		GemManager.prototype.tryToClear = function(x, type) {
		    var foundGems = this.getClosestGroup(x, this.scene.levelHeight, type, true);
		    if(foundGems.length >= this.gemsNeededToClear) {
		        this.clearGems(x, foundGems[0].y, type);
		        return true;
		    } else {
		        return false;
		    }
		};

		// Clears a group of gems using a flood fill algorithm
		GemManager.prototype.clearGems = function(x, y, type) {
		    if(this.gems[y] && this.gems[y][x] && this.gems[y][x] !== -1 && this.gems[y][x].type === type) {
		        this.gems[y][x] = -1;
		        this.scene.score += 100;
		        this.clearGems(x - 1, y, type);
		        this.clearGems(x + 1, y, type);
		        this.clearGems(x, y - 1, type);
		        this.clearGems(x, y + 1, type);
		    }
		};

		// This method courtesy of github user nickmass (nickmass.com)
		GemManager.prototype.collapse = function() {
		    var gem, gemBelow;
		    var didMove = false;
		    
		    for(var x = 0; x < this.gems[0].length; x++) {
		         for(var y = 0; y < this.gems.length; y++) {
		            gem = this.gems[y][x];
		            gemBelow = this.gems[y+1] && this.gems[y+1][x] ? this.gems[y+1][x] : -1;

		            if(y === 0 && gem === -1) { this.collapseCounter++; }
		            
		            if(gem === -1 && gemBelow !== -1) {
		                didMove = true;
		                gemBelow.y--;
		                this.gems[y][x] = gemBelow;
		                this.gems[y+1][x] = -1;
		            }
		        }
		    }
		    if(didMove) { this.collapse(); }
		};

		GemManager.prototype.update = function() {
		    for(var y = 0; y < this.gems.length; y++) {
		        for(var x = 0; x < this.gems[y].length; x++) {
		            if(this.gems[y][x] !== -1) {
		                this.gems[y][x].update();
		            }
		        }
		    }
		};

		GemManager.prototype.draw = function() {
		    for(var y = 0; y < this.gems.length; y++) {
		        for(var x = 0; x < this.gems[y].length; x++) {
		            if(this.gems[y][x] !== -1) {
		                this.gems[y][x].draw();
		            }
		        }
		    }
		};

		var VectorEngine2d = function(canvas, contentPath) {
		    this.renderManager = new RenderManager(canvas);
		    this.inputManager = new InputManager({});
		    this.sceneManager = new SceneManager(this);
		    this.resourceManager = new ResourceManager(contentPath);
		    this.lastTime;
		    this.curTime;
		    this.sceneManager.loadScene(new Level(this, 0));
		    this.stats;
		};
		 
		// Execute logic
		VectorEngine2d.prototype.update = function() {
		    this.sceneManager.update();
		};

		// Draw to the screen
		VectorEngine2d.prototype.draw = function() {
		    this.renderManager.smoothImageScaling(false);

		    this.renderManager.clear("#141414");
		    this.sceneManager.draw();
		    
		    this.renderManager.drawingCanvasContext.save();
		    this.renderManager.drawingCanvasContext.drawImage(
		        this.renderManager.canvas, 0, 0, 
		        this.renderManager.drawingCanvas.width, 
		        this.renderManager.drawingCanvas.height
		    );
		    this.renderManager.drawingCanvasContext.restore();
		};

		VectorEngine2d.prototype.gameloop = function() {
		    this.stats.begin();
		    
		    this.update();
		    this.draw();
		    this.lastTime = this.curTime;
		    this.curTime = new Date().getTime();
		    
		    this.stats.end();
		};

		// Create the drawing area and start the gameloop
		VectorEngine2d.prototype.run = function() {
		    var _this = this;
		    
		    // mrdoob stats.js fps counter
		    // https://github.com/mrdoob/stats.js
		    this.stats = new Stats();
		    this.stats.setMode(0); // 0: fps, 1: ms
		    this.stats.domElement.style.position = 'absolute';
		    this.stats.domElement.style.left = '0px';
		    this.stats.domElement.style.top = '0px';
		    document.body.appendChild(this.stats.domElement);
		   
		    this.curTime = new Date().getTime();
		    this.lastTime = this.curTime - 1;
		    
		    // Check for animation frame support
		    var animationFrame = window.requestAnimationFrame ||
		        window.webkitRequestAnimationFrame ||
		        window.mozRequestAnimationFrame    ||
		        window.oRequestAnimationFrame      ||
		        window.msRequestAnimationFrame     ||
		        null;

		    if (animationFrame !== null) {
		        var recursiveAnim = function() {
		            _this.gameloop();
		            animationFrame(recursiveAnim);
		        };

		        // start the gameloop
		        animationFrame(recursiveAnim);
		    } else {
		        // Old browser fall-back
		        setInterval(gameloop, 1000.0 / 60.0);
		    }
		};
	</script>
	
	<script>
		var game;
		window.onload = function() {
			game = new VectorEngine2d("gameCanvas", "content/");
			game.run();
		};
	</script>
	<style>
		body {
			background: #000;
			color: #666;
			font-size: 8pt;
			font-family: sans-serif;
			padding: 0;
		}
        canvas {
            position: absolute;
            left: 50%;
            top: 50%;
            width: 480px;
            height: 720px;
            margin: -360px 0 0 -240px;
        }
	</style>
</head>
<body>
	<canvas width="480" height="720" id="gameCanvas"></canvas>

<div id="stats" style="width: 80px; opacity: 0.9; cursor: pointer; position: absolute; left: 0px; top: 0px;"><div id="fps" style="padding: 0px 0px 3px 3px; text-align: left; background-color: rgb(0, 0, 34); display: block;"><div id="fpsText" style="color: rgb(0, 255, 255); font-family: Helvetica, Arial, sans-serif; font-size: 9px; font-weight: bold; line-height: 15px;">33 FPS (18-60)</div><div id="fpsGraph" style="position: relative; width: 74px; height: 30px; background-color: rgb(0, 255, 255);"><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 23.1px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 12px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 12.3px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 12px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 15.3px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 18.299999999999997px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 14.1px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 14.7px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 16.2px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 15.3px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 15px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 16.2px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 14.399999999999999px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 14.7px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 14.399999999999999px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 15px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 14.399999999999999px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 15px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 15px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 14.399999999999999px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 14.7px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 14.7px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 15px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 15px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 15px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 14.7px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 15px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 15.3px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 12px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 12px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 12px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 12px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 12.900000000000002px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 15.3px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 12px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 14.7px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 24.6px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 21px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 20.1px; float: left; background-color: rgb(17, 17, 51);"></span></div></div><div id="ms" style="padding: 0px 0px 3px 3px; text-align: left; background-color: rgb(0, 34, 0); display: none;"><div id="msText" style="color: rgb(0, 255, 0); font-family: Helvetica, Arial, sans-serif; font-size: 9px; font-weight: bold; line-height: 15px;">1 MS (0-107)</div><div id="msGraph" style="position: relative; width: 74px; height: 30px; background-color: rgb(0, 255, 0);"><span style="width: 1px; height: 29.7px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 29.85px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 29.85px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 29.7px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 29.85px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 29.85px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 29.85px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 29.7px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 29.85px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 29.85px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 29.85px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 29.85px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 29.7px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 29.85px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 29.85px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 29.7px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 29.85px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 29.85px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 29.85px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 29.85px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 29.7px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 29.7px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 29.85px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 29.85px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 29.85px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 29.85px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 29.85px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 29.85px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 29.85px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 29.85px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 29.7px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 29.7px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 29.85px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 29.7px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 29.85px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 29.85px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 29.85px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 29.85px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 29.7px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 29.85px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 29.85px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 29.85px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 29.85px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 29.85px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 29.85px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 29.85px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 29.85px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 29.85px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 29.85px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 29.85px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 29.85px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 29.85px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 29.85px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 29.85px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 29.85px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 29.85px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 29.85px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 29.85px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 29.85px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 29.85px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 29.85px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 29.85px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 29.7px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 29.7px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 29.85px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 29.85px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 29.7px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 29.7px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 29.85px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 29.85px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 29.85px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 29.85px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 29.85px; float: left; background-color: rgb(17, 51, 17);"></span></div></div></div></body></html>